language: cpp

cache:
  directories:
    - tools/boost_1_68_0


before_install:
  - PY_CMD=python3
  - if [ "$TRAVIS_OS_NAME" = "windows" ]; then powershell Start-Process -PassThru -Wait PowerShell -ArgumentList "'-Command Set-MpPreference -DisableArchiveScanning \$true'"    ; fi
  - if [ "$TRAVIS_OS_NAME" = "windows" ]; then powershell Start-Process -PassThru -Wait PowerShell -ArgumentList "'-Command Set-MpPreference -DisableBehaviorMonitoring \$true'" ; fi
  - if [ "$TRAVIS_OS_NAME" = "windows" ]; then powershell Start-Process -PassThru -Wait PowerShell -ArgumentList "'-Command Set-MpPreference -DisableRealtimeMonitoring \$true'" ; fi

addons:
  apt:
    packages:
    - python3
    - python3-pip
    - python3-setuptools

matrix:
  include:
    - os: linux
      dist: xenial
      compiler: gcc
      install: 
      - $PY_CMD -m pip install --upgrade pip
      - $PY_CMD -m pip install -r maraboupy/test_requirements.txt
      script:
      - mkdir -p build
      - cd build
      - cmake .. -DRUN_UNIT_TEST=ON -DPYTHON_EXECUTABLE=$(which $PY_CMD)
      - cmake --build . -j 2
      - ctest -L system -j 2
      - ctest -L regress[0-1] -j 2
      - cd ..
      - $PY_CMD -m pytest maraboupy/test

    - os: linux
      dist: xenial
      compiler: clang
      install: 
      - $PY_CMD -m pip install --upgrade pip
      - $PY_CMD -m pip install -r maraboupy/test_requirements.txt
      script:
      - mkdir - p build
      - cd build
      - cmake .. -DRUN_UNIT_TEST=ON -DPYTHON_EXECUTABLE=$(which $PY_CMD)
      - cmake --build . -j 2
      - ctest -L system -j 2
      - ctest -L regress0 -j 2
      - cd ..
      - $PY_CMD -m pytest maraboupy/test

    - os: windows
      script:
      - choco install python3 --params "/InstallDir:C:\Python3"
      - /c/Python3/Scripts/pip install --upgrade pip
      - /c/Python3/Scripts/pip install -r maraboupy/test_requirements.txt
      - mkdir -p build
      - cd build
      - cmake .. -DRUN_UNIT_TEST=ON -DPYTHON_EXECUTABLE=/c/Python3/python -G"Visual Studio 15 2017 Win64"
      - cmake --build . --config Release
      - ctest -L system -j 2
      - ctest -L regress0 -j 2 # does not work ...
      - cd ..
      - /c/Python3/python -m pytest maraboupy/test

notifications:
  email:
    on_success: change
    on_failure: always
